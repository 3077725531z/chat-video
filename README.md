# 聊天视频小软件

一个简单的实时聊天和视频通话应用程序。

## 功能特点

- 💬 实时文本聊天（消息永久保存）
- 📹 视频通话功能（高清视频，更大窗口）
- 🎤 音频通话功能
- 👥 在线用户列表
- 🎨 现代化UI设计（完美适配手机和桌面）
- 💾 消息历史记录（自动保存最近1000条消息）
- 📱 移动端优化（触摸友好，全屏视频）
- 🔄 响应式设计（自适应各种屏幕尺寸）

## 技术栈

- **后端**: Node.js + Express + Socket.io
- **前端**: HTML + CSS + JavaScript
- **视频通话**: WebRTC
- **存储**: JSON文件（消息持久化）

## 安装步骤

1. 安装依赖：
```bash
npm install
```

2. 启动服务器：
```bash
npm start
```

3. 打开浏览器访问：
```
http://localhost:3000
```

## 使用方法

### 桌面端
1. 输入昵称并点击"加入聊天"
2. 在聊天框中输入消息并发送（消息会自动保存）
3. 点击"开启视频"开始视频通话（视频窗口更大，支持高清）
4. 点击"开启音频"开启音频通话
5. 可以同时控制视频和音频的开启/关闭
6. 新加入的用户可以看到历史聊天记录

### 移动端（手机/平板）
1. 在手机浏览器中打开应用（支持iOS Safari、Chrome、微信等）
2. 输入昵称并点击"加入聊天"
3. 视频布局优化：
   - 对方视频为主画面（全屏显示）
   - 自己的视频以小窗口显示在右下角
   - 点击全屏按钮可以全屏观看对方视频
4. 控制按钮采用大按钮设计，方便触摸操作
5. 支持横屏和竖屏模式自动适配
6. 键盘弹出时自动调整布局
7. 可以添加到主屏幕，像原生应用一样使用

## 功能说明

### 消息存储
- 所有聊天消息会自动保存到 `messages.json` 文件
- 新用户加入时会自动加载最近50条历史消息
- 最多保存1000条消息（超出后自动删除最旧的消息）

### 视频通话
- **桌面端**：视频窗口更大（最小高度350px），支持高清视频（1280x720）
- **移动端**：优化视频布局，对方视频为主画面，自己的视频以小窗口显示
- 支持全屏观看视频（移动端和桌面端）
- 即使你没有开启视频，也能看到其他用户开启的视频
- 本地视频镜像显示，更符合使用习惯
- 移动端自动使用适合设备的视频分辨率（640x480）

### 多用户支持
- 支持多个用户同时在线
- 每个用户可以看到所有在线用户
- 视频通话支持多用户（显示第一个开启视频的用户）

## 注意事项

- 需要允许浏览器访问摄像头和麦克风权限
- **桌面端**：建议使用现代浏览器（Chrome、Firefox、Edge等）
- **移动端**：支持iOS Safari、Chrome、微信浏览器等
- 视频通话功能需要在同一网络环境或使用公网IP
- 使用Google STUN服务器进行NAT穿透
- 消息文件 `messages.json` 会自动创建
- **移动端**：建议添加到主屏幕，获得更好的使用体验
- **移动端**：横屏模式下视频显示效果更佳

## 文件说明

- `server.js`: 后端服务器代码（包含消息存储逻辑）
- `public/index.html`: 前端页面
- `public/style.css`: 样式文件
- `public/app.js`: 前端逻辑代码（WebRTC连接）
- `messages.json`: 消息存储文件（自动生成）

## 故障排除

1. **看不到对方的视频**：
   - 确保双方都开启了视频
   - 检查浏览器控制台是否有错误信息
   - 尝试刷新页面重新连接
   - **移动端**：检查是否允许了摄像头权限

2. **消息没有保存**：
   - 检查 `messages.json` 文件是否存在
   - 确保服务器有写入权限

3. **视频连接失败**：
   - 检查防火墙设置
   - 确保在同一网络或使用公网IP
   - 尝试使用不同的浏览器
   - **移动端**：尝试使用WiFi而不是移动数据网络

4. **移动端问题**：
   - 如果页面显示不正常，尝试清除浏览器缓存
   - 确保使用HTTPS或localhost（某些浏览器要求）
   - iOS Safari可能需要手动允许摄像头和麦克风权限
   - 如果视频卡顿，尝试关闭其他应用释放内存

## 🚀 快速部署

### 5分钟部署到免费平台

**最简单方法：使用Render**

1. **上传代码到GitHub**
   - 创建GitHub仓库
   - 上传所有文件

2. **部署到Render**
   - 访问 https://render.com
   - 使用GitHub登录
   - 选择仓库并部署
   - 等待5-10分钟

3. **完成！**
   - 获得免费HTTPS URL
   - 可以在任何地方访问
   - 完美支持移动端

**详细部署步骤请查看**: `README-部署.md` 或 `一键部署指南.md`

### 其他部署平台

- **Railway**: https://railway.app（快速，不休眠）
- **Fly.io**: https://fly.io（需要CLI）
- **Glitch**: https://glitch.com（实时编辑）

---

## 许可证

MIT License

